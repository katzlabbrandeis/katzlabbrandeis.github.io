# Visualizing Cluster Stability with Hierarchical Clustering Plots in Blech Clust 

![Visual representation of Hierarchical clustering plot to better assess cluster stability](https://oaidalleapiprodscus.blob.core.windows.net/private/org-hj3a7zwinu5hXuZCuU2WvRFJ/user-o4AWhhARg4pLttg3dlHwlTci/img-X8oKnOCoW5BdYq27FRUfcyRJ.png?st=2025-03-03T16%3A56%3A52Z&se=2025-03-03T18%3A56%3A52Z&sp=r&sv=2024-08-04&sr=b&rscd=inline&rsct=image/png&skoid=d505667d-d6c1-4a0a-bac7-5c84a87759f8&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2025-03-03T02%3A35%3A17Z&ske=2025-03-04T02%3A35%3A17Z&sks=b&skv=2024-08-04&sig=7ZUyjOl2FEjsTvj7zaD0zY05O5/rkyItMbhX8Ahp/gw%3D)


**Date: January 11, 2024**

**Contributors: abuzarmahmood, Abuzar Mahmood**

## Introduction

This blog post will discuss an important pull request made to the Blech Clust repository on GitHub. The pull request, titled "Hierarchical clustering plot to better assess cluster stability," was created on January 11, 2024. This change aims to enhance our visualization of the clustering process, making it easier to assess the stability of the clusters generated by Blech Clust.

## Understanding the Changes

The PR introduces a hierarchical clustering plot to the Blech Clust toolkit, allowing us to visualize the underlying features of each cluster more clearly. The code changes spanned across three files: `blech_clust.py`, `blech_post_process.py`, and a new file `utils/cluster_stability.py`.

The changes in `blech_clust.py` involve adding an extra line to call the newly created `cluster_stability.py` script. This script is now part of the processing pipeline for each electrode's data.

```diff
@@ -226,6 +226,7 @@
     f.write(f'DATA_DIR={dir_name} \n')
     f.write('ELECTRODE_NUM=$1 \n')
     f.write('python $BLECH_DIR/blech_process.py $DATA_DIR $ELECTRODE_NUM \n')
+    f.write('python $BLECH_DIR/utils/cluster_stability.py $DATA_DIR $ELECTRODE_NUM \n')
```

In `blech_post_process.py`, a few import statements were removed as they are no longer needed:

```diff
@@ -4,11 +4,7 @@
 import os
 import tables
 import numpy as np
-import easygui
-import ast
-import re
 import pylab as plt
-import matplotlib.image as mpimg
 from sklearn.mixture import GaussianMixture
 import argparse
 import pandas as pd
```

The most important change lies in the newly created `utils/cluster_stability.py`, which contains the logic for generating hierarchical clustering plots. This script works by loading electrode data, loading cluster predictions from disk, and performing hierarchical clustering on spike features. It then generates two subplots for each clustering solution: a dendrogram of the hierarchical clustering, and the same plot but with data points colored by cluster.

## Impact and Benefits

The introduction of hierarchical clustering plots is a significant enhancement to the Blech Clust toolkit. This new feature provides a more intuitive way to visualize the stability of clusters. By creating a dendrogram, this change allows us to see the hierarchical relationships between clusters and the data points within them.

Moreover, the colored plot is particularly useful for visualizing the distribution of data points across clusters, which can help in identifying any potential outliers or anomalies.

## Conclusion

This pull request marks a significant step forward in the development of Blech Clust. The introduction of hierarchical clustering plots not only enhances the toolkit's visualization capabilities but also provides an invaluable tool for better assessing cluster stability. These advancements underscore the ongoing commitment to improving and refining the toolkit for the benefit of all users.